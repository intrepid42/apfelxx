\documentclass[10pt,a4paper]{article}
\usepackage{amsmath,amssymb,bm,makeidx,subfigure}
\usepackage[italian,english]{babel}
\usepackage[center,small]{caption}[2007/01/07]
\usepackage{fancyhdr}
\usepackage{color}

\definecolor{blu}{rgb}{0,0,1}
\definecolor{verde}{rgb}{0,1,0}
\definecolor{rosso}{rgb}{1,0,0}
\definecolor{viola}{rgb}{1,0,1}
\definecolor{arancio}{rgb}{1,0.5,0}
\definecolor{celeste}{rgb}{0,1,1}
\definecolor{rosa}{rgb}{1,0.3,0.5}

\oddsidemargin = 12pt
\topmargin = 0pt
\textwidth = 440pt
\textheight = 650pt

\makeindex

\begin{document}

\section{Structure of the observables}

Let us start from Eq.~(2.6) of Ref.~\cite{Scimemi:2017etj}, that is
the fully differential cross section for lepton-pair production in the
region in which the TMD factorisation applies, $i.e.$ $q_T \ll
Q$. After some minor manipulations, it reads:
\begin{equation}\label{eq:crosssection}
  \frac{d\sigma}{dQ dy dq_T} =
  \frac{16\pi\alpha^2q_T}{3N_c Q^3} H(Q,\mu) \sum_q C_q(Q)
  \int\frac{d^2\mathbf{b}}{4\pi} e^{i \mathbf{b}\cdot \mathbf{q}_T} \overline{F}_q(x_1,\mathbf{b};\mu,\zeta) \overline{F}_{\bar{q}}(x_2,\mathbf{b};\mu,\zeta)\,,
\end{equation}
where $Q$, $y$, and $q_T$ are the invariant mass, the rapidity, and
the transverse momentum of the lepton pair, respectively, while
$N_c=3$ is the number of colours, $\alpha$ is the electromagnetic
coupling, $H$ is the appropriate QCD hard factor that can be
perturbatively computed, and $C_q$ are the effective electroweak
charges. In addition, the variables $x_1$ and $x_2$ are functions of
$Q$ and $y$ and are given by:
\begin{equation}\label{eq:Bjorkenx12}
  x_{1,2} = \frac{Q}{\sqrt{s}}e^{\pm y}\,,
\end{equation}
being $\sqrt{s}$ the centre-of-mass energy of the collision. In
Eq.~(\ref{eq:crosssection}) we are using the short-hand notation:
\begin{equation}
\overline{F}_q(x,\mathbf{b};\mu,\zeta) \equiv xF_q(x,\mathbf{b};\mu,\zeta)\,,
\end{equation}
that is convenient for the implementation. The scales $\mu$ and
$\zeta$ are introduced through TMD factorisation to factorise
collinear and rapidity divergences. As usual, despite they are
arbitrary scales, they are typically chosen
$\mu=\sqrt{\zeta}=Q$. Therefore, for all practical purposes their
presence is fictitious.

The computation-intensive part of Eq.(\ref{eq:crosssection}) has the
form of the integral:
\begin{equation}\label{eq:integral}
I_{ij}(x_1,x_2,q_T;\mu,\zeta)=\int\frac{d^2\mathbf{b}}{4\pi} e^{i \mathbf{b}\cdot \mathbf{q}_T} \overline{F}_i(x_1,\mathbf{b};\mu,\zeta) \overline{F}_{j}(x_2,\mathbf{b};\mu,\zeta)\,.
\end{equation}
where $\overline{F}_{i(j)}$ are combinations of evolved TMD PDFs. At
this stage, for convenience, $i$ and $j$ do not coincide with $q$ and
$\bar{q}$ but they are linked through a simple linear
transformation. The integral over the bidimensional impact parameter
\textbf{b} has to be taken. However, $\overline{F}_{i(j)}$ only depend
on the absolute value of \textbf{b}, therefore Eq.~(\ref{eq:integral})
can be written as:
\begin{equation}\label{eq:integral2}
I_{ij}(x_1,x_2,q_T;\mu,\zeta)=\frac12\int_0^\infty db\,b J_0(bq_T)  \overline{F}_i(x_1,b;\mu,\zeta) \overline{F}_{j}(x_2,b;\mu,\zeta)\,.
\end{equation}
where $J_0$ is the zero-th order Bessel function of the first kind
whose integral representation is:
\begin{equation}
J_0(x) = \frac1{2\pi}\int_0^{2\pi} d\theta e^{ix\cos(\theta)}\,.
\end{equation}
The single evolved TMD PDF $\overline{F}_i$ at the final scales $\mu$
and $\zeta$ is obtained by multiplying the same TMD PDF at the initial
scales $\mu_0$ and $\zeta_0$ by a single evolution factor
$R_q$(\footnote{Note that in Eq.~(\ref{eq:crosssection}) the gluon TMD
  PDF $\overline{F}_g$ is not involved. If also the gluon TMD PDF was
  involved, it would evolve by means of a different evolution factor
  $R_g$.}).  that is:
\begin{equation}\label{eq:evolution}
  \overline{F}_i(x,b;\mu,\zeta) = R_q(\mu_0,\zeta_0\rightarrow \mu,\zeta;b)
  \overline{F}_i(x,b;\mu_0,\zeta_0)\,.
\end{equation}

The initial scale TMD PDFs at small values $b$ can be written as:
\begin{equation}\label{eq:LOconv}
\overline{F}_i(x,b;\mu_0,\zeta_0) = \sum_{j=g,q(\bar{q})}x\int_x^1\frac{dy}{y}C_{ij}(y;\mu_0,\zeta_0)f_j\left(\frac{x}{y},\mu_0\right)\,,
\end{equation}
where $f_j$ are the collinear PDFs (including the gluon) and $C_{ij}$
are the so-called matching functions that are perturbatively
computable and are currently known to NNLO, $i.e.$
$\mathcal{O}(\alpha_s^2)$. If we define:
\begin{equation}
\overline{f}_i\left(x,\mu_0\right) = xf_i\left(x,\mu_0\right)\,,
\end{equation}
Eq.~(\ref{eq:LOconv}) can be written as:
\begin{equation}\label{eq:LOconvMod}
\overline{F}_i(x,b;\mu_0,\zeta_0) =
\sum_{j=g,q(\bar{q})}\int_x^1dy\,C_{ij}(y;\mu_0,\zeta_0)  \overline{f}_i\left(\frac{x}{y},\mu_0\right)\,.
\end{equation}
Putting Eqs.~(\ref{eq:evolution}) and~(\ref{eq:LOconvMod}), one finds:
\begin{equation}\label{eq:pertTMD}
  \overline{F}_i(x,b;\mu,\zeta) = R_q(\mu_0,\zeta_0\rightarrow \mu,\zeta;b)
  \sum_{j=g,q(\bar{q})}\int_x^1dy\,C_{ij}(y;\mu_0,\zeta_0)  \overline{f}_i\left(\frac{x}{y},\mu_0\right)\,.
\end{equation}

Matching and the evolution are affected by non-perturbative effects
that become relevant at large $b$. In order to account for such
effects, one usually introduces a phenomenological function
$f_{\rm NP}$. In the traditional approach (CSS~\cite{Collins:2011zzd})
the $b$-space TMDs get a multiplicative correction that does not
depend on the flavour. In addition, the perturbative content of the
TMDs is smoothly damped away at large $b$ by introducing the so-called
$b_*$-prescription:
\begin{equation}\label{eq:LOconvNP1}
  \overline{F}_i(x,b;\mu,\zeta) \rightarrow \overline{F}_i(x,b_*;\mu,\zeta) f_{\rm NP}(x,b,\zeta)\,,
\end{equation}
where $b_*\equiv b_*(b)$ is a monotonic function of the impact
parameter $b$ such that:
\begin{equation}
  \lim_{b\rightarrow 0}
  b_*(b) = b_{\rm min}\quad\mbox{and}\quad\lim_{b\rightarrow \infty}
  b_*(b) = b_{\rm max}\,,
\end{equation}
being $b_{\rm min}$ and $b_{\rm max}$ constant values both in the
perturbative region. Including the non-perturbative function,
Eq.~(\ref{eq:integral2}) becomes:
\begin{equation}\label{eq:integral3}
\begin{array}{l}
\displaystyle I_{ij}(x_1,x_2,q_T;\mu,\zeta) = \displaystyle \int_0^\infty db\,J_0(bq_T)\left[\frac{b}2 
\mathcal{L}_{ij}(x_1,x_2,b_*(b);\mu,\zeta) f_{\rm NP}(x_1,b,\zeta)
  f_{\rm NP}(x_2,b,\zeta) \right]\\
\\
\displaystyle =\frac{1}{q_T}\int_0^\infty d\bar{b}\,J_0(\bar{b})\left[\frac{\bar{b}}{2q_T} 
\mathcal{L}_{ij}\left(x_1,x_2,b_*\left (\frac{\bar{b}}{q_T}\right);\mu,\zeta\right) f_{\rm NP}\left(x_1,\frac{\bar{b}}{q_T},\zeta\right)
  f_{\rm NP}\left(x_2,\frac{\bar{b}}{q_T},\zeta\right) \right]
\,,
\end{array}
\end{equation}
with:
\begin{equation}
\mathcal{L}_{ij} (x_1,x_2,b_*;\mu,\zeta) \equiv
\overline{F}_i(x_1,b_*;\mu,\zeta) \overline{F}_{j}(x_2,b_*;\mu,\zeta) \,.
\end{equation}
Eq.~(\ref{eq:integral3}) is a Hankel tranform and can be efficiently
computed using the so-called Ogata quadrature~\cite{Ogata:quadrature}.
Effectively, the computation of the integral in
Eq.~(\ref{eq:integral}) is achieved through a weighted sum:
\begin{equation}\label{eq:ogataquadrature}
I_{ij}(x_1,x_2,q_T;\mu,\zeta) \simeq
                                                     \frac1{q_T}\sum_{n=1}^N
                                                     \frac{w_n^{(0)}z_n^{(0)}}{2q_T} 
\mathcal{L}_{ij}\left(x_1,x_2,b_*\left (\frac{z_n^{(0)}}{q_T}\right);\mu,\zeta\right) f_{\rm NP}\left(x_1,\frac{z_n^{(0)}}{q_T},\zeta\right)
  f_{\rm NP}\left(x_2,\frac{z_n^{(0)}}{q_T},\zeta\right)\,,
\end{equation}
where the unscaled coordinates $z_n^{(0)}$ and the weights $w_n^{(0)}$
can be precomputed in terms of Bessel functions and one single
parameter (see Ref.~\cite{Ogata:quadrature} for more details,
specifically Eqs.~(5.1) and~(5.2))\footnote{The superscript 0 in
  $z_n^{(0)}$ and $w_n^{(0)}$ indicates that here we are performing a
  Hankel tranform that involves the Bessel function of degree zero
  $J_0$. This is useful in view of the next section in which the
  integration over $q_T$ will give rise to a similar Hankel transform
  with $J_0$ replaced by $J_1$. Also in that case the Ogata quadrature
  algorithm can be applied.}. Based on the (empirically verified)
assumption that the absolute value of each term in the sum in the
r.h.s. of Eq.~(\ref{eq:ogataquadrature}) is smaller than that of the
preceding one, the truncation number $N$ is chosen dynamically in such
a way that the $(N+1)$-th term is smaller in absolute value than a
user-defined cutoff relatively to the sum of the preceding $N$
terms. Eq.~(\ref{eq:ogataquadrature}) factors out the non-perturbative
part of the calculation represented by $f_{\rm NP}$ from the
perturbative content.

As customary in QCD, the most convenient basis for the matching in
Eq.~(\ref{eq:LOconv}) is the so-called ``evolution'' basis
(\textit{i.e.} $\Sigma$, $V$, $T_3$, $V_3$, etc.). In fact, in this
basis the operators matrix $C_{ij}$ is almost diagonal with the only
exception of crossing terms that couple the gluon and the singlet
$\Sigma$ distributions. As a consequence, this is the most convenient
basis for the computation of $I_{ij}$. On the other hand, TMDs in
Eq.~(\ref{eq:crosssection}) are in the so-called ``physical'' basis
(\textit{i.e.} $d$, $\bar{d}$, $u$, $\bar{u}$, etc.). Therefore, we
need to rotate $I_{ij}$ from the evolution basis, over which the
indices $i$ and $j$ run, to the physical basis. This is done by means
of an appropriate constant matrix $T$, so that:
\begin{equation}\label{eq:lumiInterRot}
I_{q\bar{q}}(x_1,x_2,q_T;\mu,\zeta)= \sum_{ij}T_{qi}T_{\bar{q}j}I_{ij}(x_1,x_2,q_T;\mu,\zeta)\,.
\end{equation}
Putting all pieces together, one can conveniently write the cross
section in Eq.~(\ref{eq:crosssection}) as:
\begin{equation}\label{eq:fastdiffxsec}
  \frac{d\sigma}{dQ dy dq_T} =\sum_{n=1}^N w_n^{(0)} S\left(x_1,x_2,\frac{z_n^{(0)}}{q_T};\mu,\zeta\right) f_{\rm NP}\left(x_1,\frac{z_n^{(0)}}{q_T},\zeta\right) f_{\rm NP}\left(x_2,\frac{z_n^{(0)}}{q_T},\zeta\right)\,,
\end{equation}
with:
\begin{equation}\label{eq:pertfact}
\begin{array}{l}
\displaystyle  S(x_1,x_2,b;\mu,\zeta) =
  \frac{16\pi\alpha^2}{3N_c Q^3} H(Q,\mu) \frac{b}{2}\sum_q C_q(Q)
  \sum_{ij}T_{qi}T_{\bar{q}j} 
\mathcal{L}_{ij}\left(x_1,x_2,b_*(b);\mu,\zeta\right)\\
\\
\displaystyle =\frac{16\pi\alpha^2}{3N_c Q^3}
    H(Q,\mu) \frac{b}{2}\sum_q C_q(Q) \left[
\overline{F}_q\left(x_1,b_*(b);\mu,\zeta \right)\right] \left[
\overline{F}_{\bar{q}}\left(x_2,b_*(b);\mu,\zeta \right)\right]\,,
\end{array}
\end{equation}
with:
\begin{equation}
\overline{F}_q(x_1,b;\mu,\zeta) = \sum_{i} T_{qi}\overline{F}_i(x_1,b;\mu,\zeta)\,.
\end{equation}
Eq.~(\ref{eq:fastdiffxsec}) allows one to precompute the weights $S$
in such a way that the differential cross section in
Eq.~(\ref{eq:crosssection}) can be computed as a simple weighted sum
of the non-perturbative contribution. A misleading aspect of
Eq.~(\ref{eq:pertfact}) is the fact that $S$ has five arguments. In
actual facts, $S$ only depends on three independent variables. The
reason is that $\mu$ and $\zeta$ are usually taken to be proportional
to $Q$ by a constant factor. In addition $x_1$ and $x_2$ depend on $Q$
and $y$ through Eq.~(\ref{eq:Bjorkenx12}). Therefore, as expected, the
full dependence on the kinematics of the final state of
Eq.~(\ref{eq:crosssection}) can be specified by $Q$, $y$ and $q_T$ or
alternatively by $x_1$, $x_2$ and $q_T$.

\section{Integrating over the final-state kinematic variables}

Despite Eq.~(\ref{eq:fastdiffxsec}) provides a powerful tool for a
fast computation of cross sections, it is often not sufficient to
allow for a direct comparison to experimental data. The reason is that
experimental measurements of differential distributions are usually
delivered as integrated over finite regions of the final-state
kinematic phase space. In other words, experiments measure quantities
like:
\begin{equation}\label{eq:Intcrosssection}
\widetilde{\sigma}=\int_{Q_{\rm min}}^{Q_{\rm max}}dQ \int_{y_{\rm min}}^{y_{\rm max}}dy \int_{q_{T,\rm min}}^{q_{T,\rm max}}dq_T\left[\frac{d\sigma}{dQ dy dq_T} \right]\,.
\end{equation}
As a consequence, in order to guarantee performance, we need to
include the integrations above in the precomputed factors. 

\subsection{Integrating over $q_T$}

The integration over bins in $q_T$ can be carried out analytically
exploiting the following property of Bessel's function:
\begin{equation}\label{eq:besselproperty}
\int dx\,x J_0(x) = xJ_1(x)\quad\Rightarrow\quad \int_{x_1}^{x_2}
dx\,x J_0(x) = x_2J_1(x_2) - x_1J_1(x_1)\,.
\end{equation}
To see it, we observe that the differential cross section in
Eq.~(\ref{eq:crosssection}) has the following general structure:
\begin{equation}
  \frac{d\sigma}{dQ dy dq_T} \propto \int_0^\infty db\, q_T  J_0(bq_T)\dots
\end{equation}
where the ellipses indicate terms that do not depend on
$q_T$. Therefore, using Eq.~(\ref{eq:besselproperty}) we find:
\begin{equation}
\begin{array}{l}
\displaystyle \int_{q_{T,\rm min}}^{q_{T,\rm
  max}}dq_T\left[\frac{d\sigma}{dQ dy dq_T} \right] \propto \int_0^\infty db\,
  \int_{q_{T,\rm min}}^{q_{T,\rm
  max}} dq_T\,   q_T J_0(bq_T)\dots= \\
\\
\displaystyle \int_0^\infty \frac{db}{b^2}\,
  \int_{bq_{T,\rm min}}^{bq_{T,\rm
  max}} dx\,   x J_0(x)\dots=\int_0^\infty \frac{db}{b}\left[q_{T,\rm
  max}J_1(bq_{T,\rm max}) - q_{T,\rm
  min}J_1(bq_{T,\rm min})\right]\dots\,.
\end{array}
\end{equation}
Therefore, defining:
\begin{equation}
K(q_T) \equiv \int dq_T\left[\frac{d\sigma}{dQ dy dq_T} \right]
\end{equation}
as the indefinite integral over $q_T$ of the cross section in
Eq.~(\ref{eq:crosssection}), we have that:
\begin{equation}\label{eq:primitive}
\int_{q_{T,\rm min}}^{q_{T,\rm
  max}}dq_T\left[\frac{d\sigma}{dQ dy dq_T} \right] = K(Q,y,q_{T,\rm max})
- K(Q,y,q_{T,\rm min})\,,
\end{equation}
with:
\begin{equation}
\begin{array}{l}
 \displaystyle K(Q,y,q_T) =
  \frac{16\pi\alpha^2q_T}{3N_c Q^3} H(Q,\mu) \\
\\
\displaystyle \times\sum_q C_q(Q)
  \frac12\int_0^\infty db\, J_1(bq_T) \overline{F}_q(x_1,b;\mu,\zeta) \overline{F}_{\bar{q}}(x_2,b;\mu,\zeta) f_{\rm NP}(x_1,b,\zeta)
  f_{\rm NP}(x_2,b,\zeta)\,,
\end{array}
\end{equation}
that can be computed using the Ogata quadrature as:
\begin{equation}
  K(Q,y,q_T) \simeq \sum_{n=1}^N w_n^{(1)} P\left(x_1,x_2,\frac{z_n^{(1)}}{q_T};\mu,\zeta\right) f_{\rm NP}\left(x_1,\frac{z_n^{(1)}}{q_T},\zeta\right) f_{\rm NP}\left(x_2,\frac{z_n^{(1)}}{q_T},\zeta\right)\,,
\end{equation}
where:
\begin{equation}
\begin{array}{rcl}
P(x_1,x_2,b;\mu,\zeta) &=&\displaystyle
  \frac1{b}S(x_1,x_2,b;\mu,\zeta) \\
\\
&=&\displaystyle\frac{16\pi\alpha^2}{3N_c Q^3}
    H(Q,\mu) \frac{1}{2}\sum_q C_q(Q) \left[\overline{F}_q\left(x_1,b_*(b);\mu,\zeta \right)\right] \left[\overline{F}_{\bar{q}}\left(x_2,b_*(b);\mu,\zeta \right)\right]\,,
\end{array}
\end{equation}
with $S$ defined in Eq.~(\ref{eq:pertfact}). The unscaled coordinates
$z_n^{(1)}$ and the weights $w_n^{(1)}$ can again be precomputed and
stored. Eq.~(\ref{eq:primitive}) reduces the integration in $q_T$ to a
calculation completely analogous to the unintegrated cross
section. This is particularly convenient because it avoids the
computation a numerical integration.

\subsection{On the position of the peak of the $q_T$ distribution}

It is interesting at this point to take a short detour to discuss the
postion of the peak on the distribution in $q_T$ of the cross section
in Eq.~(\ref{eq:crosssection}). The peak can be located by setting the
derivative in $q_T$ of the cross section equal to zero. To do so, we
use another property of Bessel's functions:
\begin{equation}
\frac{dJ_0(x)}{dx} = -J_1(x)\,.
\end{equation}
Using this relation, it is easy to see that:
\begin{equation}
\begin{array}{l}
\displaystyle 0 = \frac{d}{dq_T}  \left[\frac{d\sigma}{dQ dy dq_T}\right]
  =\\
\\
\displaystyle  \frac{16\pi\alpha^2}{3N_c Q^3} H(Q,\mu) \sum_q C_q(Q)
  \frac12\int_0^\infty db\,b \left[J_0(bq_T) -bq_TJ_1(bq_T)\right] 
\overline{F}_q(x_1,b_*(b);\mu,\zeta)
  \overline{F}_{\bar{q}}(x_2,b_*(b);\mu,\zeta)\\
\\
\displaystyle \times f_{\rm NP}(x_1,b,\zeta)
  f_{\rm NP}(x_2,b,\zeta)\,,
\end{array}
\end{equation}
that is equivalent to:
\begin{equation}
  \sum_q C_q(Q)
  \int_0^\infty db\,b \left[J_0(bq_T) -bq_TJ_1(bq_T)\right] 
  \overline{F}_q(x_1,b_*(b);\mu,\zeta) \overline{F}_{\bar{q}}(x_2,b_*(b);\mu,\zeta) f_{\rm NP}(x_1,b,\zeta)
  f_{\rm NP}(x_2,b,\zeta) = 0\,.
\end{equation}
The integral above can be solved numerically using the technique
discussed above and the value of $q_T$ that satisfies this equation
can be found.

\subsection{Integrating over $Q$ and $y$}

As a final step we need to perform the integrals over $Q$ and $y$
defined in Eq.~(\ref{eq:Intcrosssection}). To compute these integrals
we can only rely on numerical methods. Having reduced the integration
in $q_T$ to the difference of the two terms in the r.h.s. of
Eq.~(\ref{eq:primitive}), we can concentrate on integrating the
functions $K$ over $Q$ and $y$ for a fixed value of $q_T$:
\begin{equation}
\widetilde{K}(q_T)=\int_{Q_{\rm min}}^{Q_{\rm max}}dQ \int_{y_{\rm
    min}}^{y_{\rm max}}dy\,K(Q,y,q_T)\,,
\end{equation}
such that:
\begin{equation}\label{eq:Intcrosssection}
  \widetilde{\sigma} = \widetilde{K} (q_{T,\rm max})- \widetilde{K} (q_{T,\rm min})\,.
\end{equation}
To this purpose, it is convenient to make explicit the dependence of
$x_{1,2}$ on $Q$ and $y$ using Eq.~(\ref{eq:Bjorkenx12}). In addition,
for the sake of simplicity we will identify the scales $\mu$ and
$\sqrt{\zeta}$ with $Q$ (possible scale variations can be easily
reinstated at a later stage) and thus drop one of the arguments from
the TMD distributions $\overline{F}$ and from the hard factor $H$.
This yields:
\begin{equation}\label{eq:finalintegral}
\begin{array}{rcl}
\displaystyle  \widetilde{K}(q_T) &=& \displaystyle\int_0^\infty db\, J_1(bq_T)
  \frac{16\pi q_T}{3N_c} \int_{Q_{\rm min}}^{Q_{\rm max}}dQ\, 
  \frac{\alpha^2(Q)}{Q^3} H(Q) \sum_q C_q(Q)
  \frac12 \\
\\
&\times& \displaystyle 
                         \int_{e^{y_{\rm
    min}}}^{e^{y_{\rm max}}}d\xi\,\frac{1}{\xi} \,\overline{F}_q\left(\frac{Q}{\sqrt{s}}\xi,b_*(b);Q\right)
                         \overline{F}_{\bar{q}}\left(\frac{Q}{\sqrt{s}}\frac1{\xi},b_*(b);Q\right) \\
\\
&\times& \displaystyle f_{\rm NP}\left(\frac{Q}{\sqrt{s}}\xi,b;Q\right)
  f_{\rm NP}\left(\frac{Q}{\sqrt{s}}\frac1{\xi},b;Q\right)\,.
\end{array}
\end{equation}
Now we define a bidimensional grid in $\xi$, $\{\xi_\alpha\}$ with
$\alpha=0,\dots,N_\xi$, and in $Q$, $\{Q_\tau\}$ with
$\tau=0,\dots,N_Q$, each of which a set of interpolating functions $w$
associated. This allows us to interpolate the pair of functions
$f_{\rm NP}$ in Eq.~(\ref{eq:finalintegral}) for generic values of $\xi$
and $Q$ as:
\begin{equation}
f_{\rm NP}\left(\frac{Q}{\sqrt{s}}\xi,b;Q\right) f_{\rm NP}\left(\frac{Q}{\sqrt{s}}\frac1{\xi},b;Q\right) \simeq \sum_{\alpha=0}^{N_\xi}\sum_{\tau=0}^{N_Q}w_\alpha(\xi)w_\tau(Q) f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\xi_\alpha,b;Q_\tau\right) f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\frac1{\xi_\alpha},b;Q_\tau\right)\,.
\end{equation}
Plugging the equation above into Eq.~(\ref{eq:finalintegral}) we
obtain:
\begin{equation}
\begin{array}{rcl}
\displaystyle  \widetilde{K}(q_T) &\simeq& \displaystyle\int_0^\infty db\, J_1(bq_T)
  \sum_{\tau=0}^{N_Q}\sum_{\alpha=0}^{N_\xi}\Bigg[\frac{16\pi q_T}{3N_c} \int_{Q_{\rm min}}^{Q_{\rm max}}dQ\,w_\tau(Q)\, 
  \frac{\alpha^2(Q)}{Q^3} H(Q) \sum_q C_q(Q)
  \frac12 \\
\\
&\times& \displaystyle 
                         \int_{e^{y_{\rm
    min}}}^{e^{y_{\rm max}}}d\xi\,w_\alpha(\xi)\,\frac{1}{\xi} \,\overline{F}_q\left(\frac{Q}{\sqrt{s}}\xi,b_*(b);Q\right)
                         \overline{F}_{\bar{q}}\left(\frac{Q}{\sqrt{s}}\frac1{\xi},b_*(b);Q\right)\Bigg] \\
\\
&\times& \displaystyle f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\xi_\alpha,b;Q_\tau\right) f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\frac1{\xi_\alpha},b;Q_\tau\right)\,.
\end{array}
\end{equation}
Finally, the integration over $b$ can be performed using the Ogata
quadrature as discussed above, so that:
\begin{equation}
\begin{array}{rcl}
\displaystyle  \widetilde{K}(q_T) &\simeq& \displaystyle \sum_{n=1}^N
  \sum_{\tau=0}^{N_Q}\sum_{\alpha=0}^{N_\xi}\Bigg[w_n^{(1)}\frac{16\pi q_T}{3N_c} \int_{Q_{\rm min}}^{Q_{\rm max}}dQ\,w_\tau(Q)\, 
  \frac{\alpha^2(Q)}{Q^3} H(Q) \sum_q C_q(Q)
  \frac12 \\
\\
&\times& \displaystyle 
                         \int_{e^{y_{\rm
    min}}}^{e^{y_{\rm max}}}d\xi\,w_\alpha(\xi)\,\frac{1}{\xi} \,\overline{F}_q\left(\frac{Q}{\sqrt{s}}\xi,b_*\left(\frac{z_n}{q_T}\right);Q\right)
                         \overline{F}_{\bar{q}}\left(\frac{Q}{\sqrt{s}}\frac1{\xi},b_*\left(\frac{z_n}{q_T}\right);Q\right)\Bigg] \\
\\
&\times& \displaystyle f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\xi_\alpha,\frac{z_n}{q_T};Q_\tau\right) f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\frac1{\xi_\alpha},\frac{z_n}{q_T};Q_\tau\right)\,.
\end{array}
\end{equation}
In conclusion, if we define:
\begin{equation}
\begin{array}{rcl}
\displaystyle  W_{n\alpha\tau} & \equiv & \displaystyle w_n^{(1)}\frac{16\pi q_T}{3N_c} \int_{Q_{\rm min}}^{Q_{\rm max}}dQ\,w_\tau(Q)\, 
  \frac{\alpha^2(Q)}{Q^3} H(Q) \sum_q C_q(Q)
  \frac12 \\
\\
&\times& \displaystyle 
                         \int_{e^{y_{\rm
    min}}}^{e^{y_{\rm max}}}d\xi\,w_\alpha(\xi)\,\frac{1}{\xi} \,\overline{F}_q\left(\frac{Q}{\sqrt{s}}\xi,b_*\left(\frac{z_n}{q_T}\right);Q\right)
                         \overline{F}_{\bar{q}}\left(\frac{Q}{\sqrt{s}}\frac1{\xi},b_*\left(\frac{z_n}{q_T}\right);Q\right)\,,
\end{array}
\end{equation}
the quantity $\widetilde{K}(q_T)$ can be computed as:
\begin{equation}\label{eq:finalinterpolated}
\widetilde{K}(q_T) \simeq \sum_{n=1}^N
  \sum_{\tau=0}^{N_Q}\sum_{\alpha=0}^{N_\xi} W_{n\alpha\tau} f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\xi_\alpha,\frac{z_n}{q_T};Q_\tau\right) f_{\rm NP}\left(\frac{Q_\tau}{\sqrt{s}}\frac1{\xi_\alpha},\frac{z_n}{q_T};Q_\tau\right)\,.
\end{equation}
The advantage of Eq.~(\ref{eq:finalinterpolated}) is that the weights
$W_{n\alpha\tau}$ can be precomputed once and for all and used to fit
the function $f_{\rm NP}$.

\begin{thebibliography}{alp}

%\cite{Scimemi:2017etj}
\bibitem{Scimemi:2017etj}
  I.~Scimemi and A.~Vladimirov,
  %``Analysis of vector boson production within TMD factorization,''
  arXiv:1706.01473 [hep-ph].
  %%CITATION = ARXIV:1706.01473;%%
  %2 citations counted in INSPIRE as of 24 Oct 2017

%\cite{Collins:2011zzd}
\bibitem{Collins:2011zzd}
  J.~Collins,
  %``Foundations of perturbative QCD,''
  Camb.\ Monogr.\ Part.\ Phys.\ Nucl.\ Phys.\ Cosmol.\  {\bf 32} (2011) 1.
  %%CITATION = CMPCE,32,1;%%
  %327 citations counted in INSPIRE as of 21 Oct 2018

\bibitem{Ogata:quadrature}
  H.~Ogata,
  ``A Numerical Integration Formula Based on the Bessel Functions,''
  \texttt{http://www.kurims.kyoto-u.ac.jp/$\sim$okamoto/paper/Publ\_RIMS\_DE/41-4-40.pdf}

\end{thebibliography}

\end{document}
